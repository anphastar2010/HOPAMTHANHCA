<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Song Editor ‚Äì H·ª£p √Çm Th·ªù Ph∆∞·ª£ng</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<style>
body {
  font-family: system-ui, sans-serif;
  max-width: 900px;
  margin: auto;
  padding: 16px;
  background: #fafafa;
}

h1 { text-align: center; }
h2 { margin-top: 28px; }

input, textarea, select, button {
  width: 100%;
  padding: 10px;
  font-size: 16px;
  margin-bottom: 12px;
}

textarea {
  min-height: 200px;
  font-family: monospace;
}

button {
  background: #1976d2;
  color: white;
  border: none;
  border-radius: 6px;
}

.secondary {
  background: #616161;
}

.song-item {
  border-bottom: 1px solid #ddd;
  padding: 10px;
  cursor: pointer;
}

.song-item:hover {
  background: #eee;
}

.flex {
  display: flex;
  gap: 8px;
}

.flex button { flex: 1; }

.note {
  font-size: 14px;
  color: #555;
}

/* ===== CHORD PREVIEW ===== */
.preview-box {
  background: white;
  padding: 16px;
  border-radius: 8px;
  line-height: 1.6;
  font-size: 17px;
}

.chord {
  color: #0d47a1;
  font-weight: 700;
  font-family: "Courier New", monospace;
  margin-right: 2px;
}

pre {
  background: #f0f0f0;
  padding: 12px;
  white-space: pre-wrap;
  border-radius: 6px;
  max-height: 300px;
  overflow: auto;
}
</style>
</head>

<body>

<h1>üé∂ Song Editor</h1>

<p class="note">
‚úèÔ∏è Nh·∫≠p l·ªùi + h·ª£p √¢m d·∫°ng <code>[C]</code> <code>[F#m]</code> <code>[Bb]</code><br>
üéº Preview hi·ªÉn th·ªã ƒë√∫ng chu·∫©n khi tr√¨nh chi·∫øu<br>
üì¶ Xu·∫•t <code>songs.js</code> d√πng ngay cho web app
</p>

<hr>

<h2>0Ô∏è‚É£ IMPORT songs.js</h2>
<textarea id="importInput" placeholder="D√°n to√†n b·ªô n·ªôi dung file songs.js v√†o ƒë√¢y"></textarea>
<button class="secondary" onclick="importSongs()">üîÑ Import songs.js</button>

<hr>

<h2>1Ô∏è‚É£ NH·∫¨P / S·ª¨A B√ÄI H√ÅT</h2>

<input id="title" placeholder="T√™n b√†i h√°t" />
<input id="artist" placeholder="T√°c gi·∫£ / Ngu·ªìn (tu·ª≥ ch·ªçn)" />

<select id="key">
  <option value="">Gi·ªçng g·ªëc</option>
  <option>C</option>
  <option>C#</option><option>Db</option>
  <option>D</option>
  <option>D#</option><option>Eb</option>
  <option>E</option>
  <option>F</option>
  <option>F#</option><option>Gb</option>
  <option>G</option>
  <option>G#</option><option>Ab</option>
  <option>A</option>
  <option>A#</option><option>Bb</option>
  <option>B</option>
</select>

<textarea id="content" placeholder="[C]L·∫°y Ch√∫a con ƒë·∫øn
[Am]Tr∆∞·ªõc ngai vinh hi·ªÉn
[F]L√≤ng con th·ªù [G]l·∫°y Ng√†i"></textarea>

<div class="flex">
  <button onclick="addOrUpdateSong()">‚ûï Th√™m / C·∫≠p nh·∫≠t</button>
  <button class="secondary" onclick="clearForm()">üßπ Xo√° form</button>
</div>

<hr>

<h2>2Ô∏è‚É£ DANH S√ÅCH B√ÄI H√ÅT</h2>
<div id="songList"></div>

<hr>

<h2>3Ô∏è‚É£ PREVIEW HI·ªÇN TH·ªä H·ª¢P √ÇM</h2>
<div id="formattedPreview" class="preview-box"></div>

<hr>

<h2>4Ô∏è‚É£ XU·∫§T FILE songs.js</h2>
<button onclick="exportSongs()">‚¨áÔ∏è T·∫£i songs.js</button>
<pre id="rawPreview"></pre>

<script>
let songs = [];

/* ========= IMPORT ========= */
function importSongs() {
  const text = importInput.value.trim();
  if (!text.includes("const songs")) return alert("Sai ƒë·ªãnh d·∫°ng");

  try {
    const arrayText = text
      .replace(/^[\s\S]*?const songs\s*=\s*/, "")
      .replace(/;?\s*$/, "");
    songs = eval(arrayText);
    renderList();
    alert("‚úÖ Import " + songs.length + " b√†i");
  } catch {
    alert("‚ùå Import l·ªói");
  }
}

/* ========= CRUD ========= */
function addOrUpdateSong() {
  if (!title.value || !key.value || !content.value)
    return alert("Thi·∫øu d·ªØ li·ªáu");

  const s = songs.find(x => x.title === title.value);
  if (s) {
    Object.assign(s, getForm());
  } else {
    songs.push({ id: Date.now(), ...getForm() });
  }

  renderList();
  renderFormattedPreview(content.value);
}

function getForm() {
  return {
    title: title.value,
    artist: artist.value,
    key: key.value,
    content: content.value
  };
}

function renderList() {
  songList.innerHTML = "";
  songs.forEach(s => {
    const d = document.createElement("div");
    d.className = "song-item";
    d.textContent = s.title;
    d.onclick = () => loadSong(s);
    songList.appendChild(d);
  });
}

function loadSong(s) {
  title.value = s.title;
  artist.value = s.artist;
  key.value = s.key;
  content.value = s.content;
  renderFormattedPreview(s.content);
}

function clearForm() {
  title.value = artist.value = content.value = "";
  key.value = "";
}

/* ========= PREVIEW ========= */
function renderFormattedPreview(text) {
  formattedPreview.innerHTML = text
    .replace(/\[([^\]]+)\]/g, '<span class="chord">[$1]</span>')
    .replace(/\n/g, "<br>");
}

/* ========= EXPORT ========= */
function exportSongs() {
  const text =
`const songs = [
${songs.map(s => `
{
  id: ${s.id},
  title: "${s.title}",
  artist: "${s.artist}",
  key: "${s.key}",
  content: \`
${s.content}
  \`
}`).join(",")}
];`;

  const blob = new Blob([text], { type: "application/javascript" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "songs.js";
  a.click();

  rawPreview.textContent = text;
}
</script>

</body>
</html>
